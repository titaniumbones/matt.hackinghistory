<!DOCTYPE html>
<html lang="en-us">
  <head><link rel="icon" href="/favicon_main.svg"><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta http-equiv="x-ua-compatible" content="ie=edge" /><meta property="og:url"  content="https://example.com/2016/11/18/sending-html-mail-with-mu4e/" />
    <meta property="og:type" content="article" /><meta property="og:title" content="Sending HTML Mail with mu4e" /><meta property="og:description" content="" /><meta property="og:image:width"  content="375" />
        <meta property="og:image:height" content="250" /><meta property="og:image" content="https://example.com/images/default_summary_hu2be732aee21a2469ead3fe1f2df8caca_2088687_600x0_resize_q75_box.jpg" /><title>History Hacker - Sending HTML Mail with mu4e</title>

    
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet"><link rel="stylesheet" type="text/css" href="/css/style.3924c953d2259a0f0beef52fc023daabdac50a4f62f4446859e57153d998e5b0.css" integrity="sha256-OSTJU9Ilmg8L7vUvwCPaq9rFCk9i9ERoWeVxU9mY5bA=">
<link rel="stylesheet" type="text/css" href="/css/monokai-sublime.9.15.8.min.91376415864fdd3a92be524052267afece4bdb1bb8c6c754f5e60c5ac28e93be.css" integrity="sha256-kTdkFYZP3TqSvlJAUiZ6/s5L2xu4xsdU9eYMWsKOk74=">
<link rel="stylesheet" type="text/css" href="/css/icons.f72c0103ff9598115ab2a76351494b950570479ce3f1795fec13fc62e4185dcf.css" integrity="sha256-9ywBA/&#43;VmBFasqdjUUlLlQVwR5zj8Xlf7BP8YuQYXc8=">
<link rel="stylesheet" type="text/css" href="/css/refresh.ccfd23f8053a1571a3e474a6877f42a6a1924c6bbf1b64c7704b49a0353b4650.css" integrity="sha256-zP0j&#43;AU6FXGj5HSmh39CpqGSTGu/G2THcEtJoDU7RlA=">
<link rel="stylesheet" type="text/css" href="/css/devicon.min.149016fbf45c8bc157d6f55ce3ee875feaa3f90446bf7d151fbc16a9f21a8859.css" integrity="sha256-FJAW&#43;/Rci8FX1vVc4&#43;6HX&#43;qj&#43;QRGv30VH7wWqfIaiFk=">
    

  </head>
  <body>
     

    <div id="preloader">
      <div id="status"></div>
    </div><nav class="navbar is-fresh is-transparent no-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">

      
      
      
      <a class="navbar-item">
        <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
        <div class="navbar-item left-menu-icon-wrapper">
          Tags
        </div>
      </a>

      <div class="navbar-item is-expanded"></div>
      <a class="navbar-item is-hidden-desktop">  
        <div data-target="navbar-menu" class="navbar-item right-menu-icon-wrapper is-hidden-desktop">
          Menu
        </div>
        <div data-target="navbar-menu" class="menu-icon-wrapper right-menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
      </a>
    </div><div id="navbar-menu" class="navbar-menu is-static">
      
      <div class="navbar-end">
        
          <a href="/" class="navbar-item is-secondary">Home</a><a href="/projects/" class="navbar-item is-secondary">Projects</a><a href="/cv/cv/" class="navbar-item is-secondary">CV</a><a href="/teaching/" class="navbar-item is-secondary">Teaching</a><a href="/posts/" class="navbar-item is-secondary">Posts</a><a href="/publication/" class="navbar-item is-secondary">Publications</a>
        
        
        <div class="navbar-item">
          <div class="dropdown is-hoverable is-centered" >
            <div class="dropdown-trigger" >
              <button class="button is-active" 
              style="color:#999;  
                    border-color:#F39200; 
                    box-shadow: none ;
                    padding-right: 0.625em ; 
                    padding-left: 0.625em  ;
                    ">

                <span>EN</span>
              </button>
            </div>
            <div class="dropdown-menu" id="dropdown-menu" role="menu" style="min-width: 0em;">
              <div class="dropdown-content" style="padding: 0rem;">
                
                  
                
                  
                <a href="https://example.com/ru/" class="dropdown-item" 
                style="text-align: center; color:#999; padding-right: 0.82em !important ; padding-left: 0.82em !important;">
                  RU
                </a>
                
                
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</nav>
<nav id="navbar-clone" class="navbar is-fresh is-transparent" role="navigation" aria-label="main navigation">
  <div class="container">
      <div class="navbar-brand">
  
        
        
        
        <a class="navbar-item">
          <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
          <div class="navbar-item left-menu-icon-wrapper">
            Tags
          </div>
        </a>
  
        <div class="navbar-item is-expanded"></div>
        <a class="navbar-item is-hidden-desktop">  
          <div data-target="cloned-navbar-menu" class="navbar-item right-menu-icon-wrapper is-hidden-desktop">
            Menu
          </div>
          <div data-target="cloned-navbar-menu" class="menu-icon-wrapper right-menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
        </a>
      </div><div id="cloned-navbar-menu" class="navbar-menu is-static">
        <div class="navbar-end"><a href="/" class="navbar-item is-secondary">Home</a><a href="/projects/" class="navbar-item is-secondary">Projects</a><a href="/cv/cv/" class="navbar-item is-secondary">CV</a><a href="/teaching/" class="navbar-item is-secondary">Teaching</a><a href="/posts/" class="navbar-item is-secondary">Posts</a><a href="/publication/" class="navbar-item is-secondary">Publications</a>
          
          
          <div class="navbar-item">
            <div class="dropdown is-hoverable is-centered" >
              <div class="dropdown-trigger" >
                <button class="button is-active" 
                style="color:#999;  
                      border-color:#F39200; 
                      box-shadow: none ;
                      padding-right: 0.625em ; 
                      padding-left: 0.625em  ;
                      ">
  
                  <span>EN</span>
                </button>
              </div>
              <div class="dropdown-menu" id="dropdown-menu" role="menu" style="min-width: 0em;">
                <div class="dropdown-content" style="padding: 0rem;">
                  
                    
                  
                    
                  <a href="https://example.com/ru/" class="dropdown-item" 
                  style="text-align: center; color:#999; padding-right: 0.82em !important ; padding-left: 0.82em !important;">
                    RU
                  </a>
                  
                  
                </div>
              </div>
            </div>
          </div>
          
        
        </div>
      </div>
    </div>
  </nav>
<section class="section is-medium">
  <div class="container">
    <div class="columns">
      <div class="column is-centered-tablet-portrait">
        <h1 class="title is-2 section-title">Sending HTML Mail with mu4e</h1>
        <h5 class="subtitle is-5 is-muted"></h5>
        <div class="divider"></div>
        
        <section class="section content has-text-justified">
          <p>John Kitchin <a href="http://kitchingroup.cheme.cmu.edu/blog/2016/10/29/Sending-html-emails-from-org-mode-with-org-mime/">has a terrific post</a> detailing some configuration/improvements to mu4e that make it easier to send html mail. This original post is really great, but I ran into quite a bit of trouble following this advice.</p>
<p>He uses a cool feature of mu4e, <code>org-mu4e-compose-org-mode</code>, which toggles the major mode of the message buffer between org-mode (when you’re in the message body) and mu4e-compose-mode (when you’re in the headers area). With a couple of custom functions, it’s easy to convert the org text to html and send a mime-multipart email from Emacs, which is quite convenient. If you add <code>org-mu4e-compose-org-mode</code> as a hook to <code>mu4e-compose-mode</code>, you can compose in html by default, which is great.</p>
<p>Unfortunately, <code>org-mu4e-compose-org-mode</code> is <strong>deprecated</strong> on account of its instability, and while John doesn’t have any problems with it, for me it was unworkable. It turns out that this “mode” isn’t really a standard emacs mode at all – instead, it’s a sly workaround that trickily adds an internal function to the ’post-command-hook in the draft buffer and switches major modes based on position. This is a neat hack, but since the function <em>invokes the major modes directly</em>, setting thefunction as a hook to <code>mu4e-compose-mode</code> leads to some funky, inadvertent looping effects. On my machine, for some reason, those effects send the underlying <code>message-send</code> function crazy, and instead of sending directly, I get this amazingly annoying question:</p>
<blockquote>
<p>Already sent message via mail; resend? (y or n) y</p>
</blockquote>
<p>On its own, that is already annoying; but worse, the sent message doesn’t get saved to my Sent folder. Instead, it’s lost completely.</p>
<p>Anyway, after fruitless hours of paying around with this, I realized that the problem could be fixed by adding a new hook to the mu4e compose functions (rather than to the compose <em>mode</em>). I’ve <a href="https://github.com/djcb/mu/pull/952">submitted those changes as a pull request</a> and hopefully they will be accepted; if not, though, feel free to navigate back to <a href="https://github.com/titaniumbones/mu/tree/org-mu4e-compose-stabilization">my branch</a> and pull/install mu from there. With those small changes, I now have frictionless html email working very quickly within emacs, using this small bit of code. It is at least 90% stolen:</p>
<div class="org-src-container">
  <pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">this is stolen from John but it didn't work for me until I</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">made those changes to mu4e-compose.el</span>
<span style="color: #707183;">(</span><span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">htmlize-and-send</span> <span style="color: #707183;">()</span>
  <span style="color: #8b2252;">"When in an org-mu4e-compose-org-mode message, htmlize and send it."</span>
  <span style="color: #707183;">(</span><span style="color: #a020f0;">interactive</span><span style="color: #707183;">)</span>
  <span style="color: #707183;">(</span><span style="color: #a020f0;">when</span> <span style="color: #707183;">(</span>member 'org~mu4e-mime-switch-headers-or-body post-command-hook<span style="color: #707183;">)</span>
    <span style="color: #707183;">(</span>org-mime-htmlize<span style="color: #707183;">)</span>
    <span style="color: #707183;">(</span>org-mu4e-compose-org-mode<span style="color: #707183;">)</span>
    <span style="color: #707183;">(</span>mu4e-compose-mode<span style="color: #707183;">)</span>
    <span style="color: #707183;">(</span>message-send-and-exit<span style="color: #707183;">)))</span>
<p><span style="color: #b22222;">;; </span><span style="color: #b22222;">This overloads the amazing C-c C-c commands in org-mode with one more function</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">namely the htmlize-and-send, above.</span>
<span style="color: #707183;">(</span>add-hook &lsquo;org-ctrl-c-ctrl-c-hook &lsquo;htmlize-and-send t<span style="color: #707183;">)</span></p>
<p><span style="color: #b22222;">;; </span><span style="color: #b22222;">Originally, I set the `</span><span style="color: #008b8b;">mu4e-compose-mode-hook</span><span style="color: #b22222;">&rsquo; here, but</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">this new hook works much, much better for me.  </span>
<span style="color: #707183;">(</span>add-hook &lsquo;mu4e-compose-post-hook
<span style="color: #707183;">(</span><span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">do-compose-stuff</span> <span style="color: #707183;">()</span>
<span style="color: #8b2252;">&ldquo;My settings for message composition.&quot;</span>
<span style="color: #707183;">(</span>org-mu4e-compose-org-mode<span style="color: #707183;">)))</span>
</pre></p>
</div>
<p>It feels great to have gotten this far. There are still some small things I’d like to be able to improve; and I think I would like to add a few wrapper functions and keybindings to my setup, but for now I’m pretty efficient.</p>
<p>Still missing:</p>
<ul class="org-ul">
  <li>
    a better HTML viewing interface! right now, html mails render as mostly text &#x2013; it would be nice to have a rendered html message by default in emacs. This is an issue several times a day when I get promotional emails from organizations I work with &#x2013; usually the html part is really important. I can access these in the browser but it&rsquo;s comparatively awkward.
  </li>
  <li>
    a way to forward these html emails to someone intact &#x2013; right now, the html parts are discarded. No idea how hard it would be to do this.
  </li>
</ul>
<p>Thanks John and Dirk-Jan for these great tools!</p>

        </section>
      </div>
    </div>
  </div>  
  <div class="container">
    <div class="columns">
      <div class="column has-text-right is-family-monospace is-centered-tablet-portrait">
        Last modified:&nbsp;19 November 2016</div>
    </div>
  </div></section>
<footer class="footer footer-dark">
  <div class="container">
    <div class="columns">
      <div class="column">
        <img src="/footer.svg" alt="">
        
      </div>
      
    <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Website</h3>
          </div>
          <ul class="link-list"><li>
              <a href="/"><span class="icon"><i class="fa fa-home"></i></span> Home</a>
            </li><li></li>
            <li><a href="/tags/">
                <span class="icon"><i class="fa fa-tag"></i></span> 
                All Tags
              </a></li>
          </ul>
        </div>
      </div>
    
      
      <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Contacts</h3>
          </div>
          <ul class="link-list">
            
            <li>
              <a href="https://www.linkedin.com/your_linkedin_profile" target="_blank">
                <span class="icon"><i class="fa fa-linkedin"></i></span>
                
                  My LinkedIn
                
              </a>
            </li>
            
                         
            
            <li>
              <a href="mailto:name.surname@domain.com" target="_blank">
                <span class="icon"><i class="fa fa-envelope"></i></span>
                
                  My Email
                
              </a>
            </li>
            
                   
                   
                   
          </ul>
        </div>
      </div>
      

      
      <div class="column">
        <div class="footer-column">
          <div class="footer-header">
              <h3>Copyright</h3>
          </div>
          <ul class="link-list">
            <li>
              <a>
                <span class="icon"><i class="fa fa-copyright"></i></span>
                Matt Price - 2020
              </a>
            </li>
          </ul>
        </div>
      </div>
      

    </div>
  </div>
</footer>
    <div id="backtotop"><a href="#"></a></div><div class="sidebar scroll">
  <div class="sidebar-header"><img src="/sidebar.svg" alt="">
    
    <a class="sidebar-close" href="javascript:void(0);">
      <i data-feather="x"></i>
    </a>
  </div>
  <div class="inner">
    <ul class="sidebar-menu">
      <li class="no-children"><a href="/tags/"><div class="columns">
              <table width="100%">  
                <tr>
                  <td class="">
                    <span class="icon"><i class="fa fa-cubes"></i></span>
                    All Tags
                  </td>
                  <td class="has-text-right" >
                      
                  </td>
                </tr>
              </table>
            </div>
          </a></ul>
  </div>
</div>
<script src="/js/jquery-2.2.4.893e90f6230962e42231635df650f20544ad22affc3ee396df768eaa6bc5a6a2.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="></script>
  <script src="/js/feather.4.22.0.1ab07abeb9975f283f6b5f29451981be680fbf77ea778f991d457511d210476a.js" integrity="sha256-GrB6vrmXXyg/a18pRRmBvmgPv3fqd4&#43;ZHUV1EdIQR2o="></script>
  <script src="/js/modernizr-3.6.0.e013a1e54e3c19d83537ba42b900d34451e5e4b2e789be27a02ac9b152edb741.js" integrity="sha256-4BOh5U48Gdg1N7pCuQDTRFHl5LLnib4noCrJsVLtt0E="></script>
  <script src="/js/refresh.62c1a9b7d85bcf4d944cd585a01dfa8fb15112a7d2cf9fb819db20493bfe7484.js" integrity="sha256-YsGpt9hbz02UTNWFoB36j7FREqfSz5&#43;4GdsgSTv&#43;dIQ="></script><script>
  window.MathJax = {
    loader: {
      load: ['core', 'input/tex-base', 'output/chtml'],  
      source: {
        'core': '\/js\/mathjax\/core.d48fedf25c74c54fa6bf79646de92b02155872bdc4f5f7d0bbfc662523d8b4f5.js',
        'input/tex-base': '\/js\/mathjax\/tex-base.1b68b8741dfc54e8f7222f88bea8ffcfc57ac54b2a2d8f4edf6800aa44d49441.js',
        'output/chtml': '\/js\/mathjax\/chtml.926cd166e0f8c1f8a566a718d60c9c58a2b7142b156d30d5f02cec7c3b0ad60a.js',
        'output/chtml/fonts/tex': '\/js\/mathjax\/tex_out.b8b2bb939c0dae84bf1390bfe6d32af13e83f647cdac01d544d2a7a517477e9d.js'
      },
    },
    chtml: {
      fontURL: '/fonts' 
    },
  };
</script><script src="/js/mathjax/startup.234a2513e6bdbc1eee06ca19abceca30fe4034e82afb373c08274c1ba2feb1a6.js" integrity="sha256-I0olE&#43;a9vB7uBsoZq87KMP5ANOgq&#43;zc8CCdMG6L&#43;saY="></script>
  <script src="/js/highlight.9.18.1.b1c58829c55afcc1f568022af4b08ed8976da404d2990b7535bd8e19c0e3310c.js" integrity="sha256-scWIKcVa/MH1aAIq9LCO2JdtpATSmQt1Nb2OGcDjMQw="></script>
  <script src="/js/highlightjs-line-numbers.2.7.0.min.ddfe282e07b7ec1ed069c23f92c7c8216ddb3f1879c4e962d37fd52adbd15a05.js" integrity="sha256-3f4oLge37B7QacI/ksfIIW3bPxh5xOli03/VKtvRWgU="></script><script>
  hljs.initHighlightingOnLoad();
  hljs.initLineNumbersOnLoad();
  document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('.codeinline').forEach((block) => {
      hljs.highlightBlock(block);
    });
  });
</script>

</body>
</html>
